<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Dex: Deterministic Predicate Expressions for Smarter Signatures - Rebooting the Web of Trust</title>
<meta name="description" content="RWOT Index - Drafts, Documents, Photos, Topics, Advance Readings, and Final Whitepapers">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Rebooting the Web of Trust">
<meta property="og:title" content="Dex: Deterministic Predicate Expressions for Smarter Signatures">
<meta property="og:url" content="http://localhost:4000/rwot-dir/_pages/rwot2-id2020/topics-and-advance-readings/DexPredicatesForSmarterSigs/">




  <meta property="og:image" content="http://localhost:4000/rwot-dir/assets/images/rebooting-the-web-of-trust-header-pages.jpeg">



  <meta name="twitter:site" content="@didecentral">
  <meta name="twitter:title" content="Dex: Deterministic Predicate Expressions for Smarter Signatures">
  <meta name="twitter:description" content="RWOT Index - Drafts, Documents, Photos, Topics, Advance Readings, and Final Whitepapers">
  <meta name="twitter:url" content="http://localhost:4000/rwot-dir/_pages/rwot2-id2020/topics-and-advance-readings/DexPredicatesForSmarterSigs/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/rwot-dir/assets/images/rebooting-the-web-of-trust-header-pages.jpeg">
  

  







  

  


<link rel="canonical" href="http://localhost:4000/rwot-dir/_pages/rwot2-id2020/topics-and-advance-readings/DexPredicatesForSmarterSigs/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "DIDecentral",
      "url": "http://localhost:4000/rwot-dir",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/rwot-dir/feed.xml" type="application/atom+xml" rel="alternate" title="Rebooting the Web of Trust Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/rwot-dir/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/rwot-dir/"><img src="/rwot-dir/assets/images/wot-logo.png" alt=""></a>
        
        <a class="site-title" href="/rwot-dir/">Drafts, Documents, Literature</a>
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="https://didecentral.com/" target="_blank" rel="noopener noreferrer">DIDecentral</a>
            </li>
<li class="masthead__menu-item">
              <a href="https://decentralized-id.com/" target="_blank" rel="noopener noreferrer">Decentralized-ID</a>
            </li>
</ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero" style=" ">
  
    <img src="/rwot-dir/assets/images/rebooting-the-web-of-trust-header-pages.jpeg" alt="Dex: Deterministic Predicate Expressions for Smarter Signatures" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
      
      
      
      
    
    
      

<nav class="nav__list">
  <h3 class="nav__title" style="padding-left: 0;">Rebooting the Web of Trust</h3>
  <input id="ac-toc" name="accordion-toc" type="checkbox">
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/rwot-dir/rwot1-sf/"><span class="nav__sub-title">RWoT1-SF</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/draft-documents/" class="">Draft Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/event-documents/" class="">Event Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/final-documents/" class="">Final Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/supporting-files/" class="">Supporting Files</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/topics-and-advance-readings/" class="">Topics and Advance Readings</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/rwot-dir/rwot2-id2020/"><span class="nav__sub-title">RWoT2-ID2020</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/draft-documents/" class="">Draft Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/event-documents/" class="">Event Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/final-documents/" class="">Final Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/supporting-files/" class="">Supporting Files</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/topics-and-advance-readings/" class="">Topics and Advance Readings</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/rwot-dir/rwot3-sf/"><span class="nav__sub-title">RWoT3-SF</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/draft-documents/" class="">Draft Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/event-documents/" class="">Event Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/final-documents/" class="">Final Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/supporting-files/" class="">Supporting Files</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/topics-and-advance-readings/" class="">Topics and Advance Readings</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Dex: Deterministic Predicate Expressions for Smarter Signatures">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Dex: Deterministic Predicate Expressions for Smarter Signatures
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  9 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <h1 id="dex-deterministic-predicate-expressions-for-smarter-signatures">Dex: Deterministic Predicate Expressions for Smarter Signatures</h1>

<p><em>©2016 Peter Todd, with contributions from Christopher Allen.<br>
Commissioned by Christopher Allen of Alacrity Software to further work on
<a href="https://github.com/WebOfTrustInfo/rebooting-the-web-of-trust/blob/master/final-documents/smart-signatures.pdf" target="_blank" rel="noopener noreferrer">Smart Signatures</a>.</em></p>

<p>While substantial effort has gone into PKI, WoT, “blockchain”, and other
schemes to better map human identities meaningful identities to public keys,
very little thought has gone into the keys themselves. Bitcoin’s scripting
system is a rare exception, showing how we can also have a more flexible and
useful notion of a cryptographic identity, with flexible validation rules set
in advance with evaluatable code. For identity systems separating the tasks of
mapping human-relevant identity to cryptographic identity, and managing the
cryptographic identity itself, has the potential to simplify both layers, and
enable cryptographic identity innovation by removing the need to update all
signature validators for every signing-side innovation.</p>

<blockquote>
  <p>Predicates: that which is affirmed or denied</p>
</blockquote>

<p>Dex is a deterministic expression standard that builds on initial exploration
and requirements definition work done by the Smart Signatures group at the Nov
2015 Rebooting The Web of Trust conference. This allows cryptographic
identities, and even protocol definitions, to be specified in terms of
predicate expressions that evaluate to either true or false. Dex is
deterministic, so for a specific environment and signature an expression will
always evaluate to the same result; Dex aims to be usable in consensus-critical
environments and draws on the author’s experience working on the
consensus-critical Bitcoin protocol and Bitcoin Core codebase.</p>

<h2 id="requirements">Requirements</h2>

<p>Before we go directly into how expressions are evaluated, it’s important to
remember <em>why</em> they’re evaluated: we’re trying to prove what the expression
evaluates to efficiently. In short, Alice is trying to prove to Bob that
expression &lt;foo&gt; returns &lt;bar&gt;. Bob wants to be able to evaluate that proof
efficiently with as little bandwidth, memory, and CPU as possible; he does not
care how much work Alice had to do to create that proof. This is completely
unlike standard programming languages, which usually have efficiency of
computation as a goal. Thus our requirements are, in order of importance:</p>

<ol>
  <li>
    <p>Determinism — Expression evaluation must be 100% deterministic across
multiple platforms.</p>
  </li>
  <li>
    <p>Efficient Validation — Determining the result of an expression, evaluated
against the specified arguments, must be cheap.</p>
  </li>
  <li>
    <p>Bounded — Attackers must not be able to create expressions that exceed
application-appropriate memory and CPU limits; enforcement of these limits must
itself be deterministic.</p>
  </li>
  <li>
    <p>Understandable — Humans examining an expression - potentially created by
an adversary! - should have a reasonable chance at understanding what the
expression is doing. This implies that raw expressions be relatively high
level.</p>
  </li>
</ol>

<h2 id="merkelized-s-expressions">Merkelized S-expressions</h2>

<p>We follow the Lisp tradition and represent both expressions and data with
merkelized (hashed) S-expressions (msexprs) defined recursively from atoms such
as numbers, strings, and symbols, and cons cells. Being hashed, all msexprs
have a unique digest with each unique msexpr mapping to a unique digest. As
values may be repreated, msexprs are directed acyclic graphs.</p>

<p>It’s often the case that not all of a particular expression is needed to prove
a particular result. For example, suppose you wish to determine what the
following expression evaluates to:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(or (or (or true true)
        (or true true))
    (or (or true true)
        (or true true)))
</code></pre></div></div>

<p>Evaluation of ``or’’ short-circuits, so we don’t actually need the entire
expression to know it evaluates to true. This allows Alice to prove to Bob that
the above returned true, even if she only gives him the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(or (or (or true true)
        #&lt;digest1&gt;)
    #&lt;digest2&gt;)
</code></pre></div></div>

<p>We call this “pruning” and will use it extensively.</p>

<h2 id="evaluation">Evaluation</h2>

<p>Atoms such as numbers, booleans, symbols, etc. are self-evaluating, and
evaluate to themselves regardless of their argument.</p>

<p>How a cons cells is evaluated depends on the car (first item) in the cell. If
the car is a symbol for a built-in function, such as the arithmetic operators
or hashing functions, the cdr (second item) is used as the argument to the
operator. For example, here’s an expression that adds two numbers:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(+ 1 1) =&gt; 2
</code></pre></div></div>

<p>The apply operator has the important role of performing argument substitution.
It takes two expressions as arguments, and substitutes all instances of the
``arg’’ symbol in the first expression with the second expression. Here’s it in
use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(apply (+ 1 arg) 1) =&gt; (+ 1 1)
</code></pre></div></div>

<p>While apply is rarely needed directly, it’s used implicityly when evaluating
cons cells whose car is an expression: the cdr of the cell is applied to the
car, and the result is evaluated, acting as a function call.</p>

<h3 id="trivial-message-signing-protocol">Trivial Message Signing Protocol</h3>

<p>Let’s make use of expression evaluation to define a simple protocol for
verifying that messages are authentic. We’ll define a message as “authentic” if
an identity predicate expression evaluates to true; basically we’re using a
predicate expression to define a cryptographic identity, rather than using a
pubkey directly.</p>

<p>We’ll need a built-in function for hashing messages:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(sha256 &lt;data&gt;) =&gt; bytes
</code></pre></div></div>

<p>As well as a function for validating signatures:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(sig_valid &lt;pubkey&gt; &lt;sig&gt; &lt;hash&gt;) =&gt; boolean
</code></pre></div></div>

<p>A message is considered valid if the persistant identity expression returns
true, when evaluated against the message and the signature expression:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(persist_id &lt;msg&gt; &lt;sig_msexpr&gt;) =&gt; boolean
</code></pre></div></div>

<p>The simplest persistant identity expression is to just just a single keypair to
validate signatures:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(sig_valid &lt;pubkey&gt; (cdr argm) (sha256 (car argm)))
</code></pre></div></div>

<p>So how does that work? Let’s look at how the expression evaluates in the case
of a valid message. For the above expression, this means that the signature
expression has been set to a valid signature. First the special symbol arg
evaluate to the argument expression given to the validation expression:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(sig_valid &lt;pubkey&gt; (cdr '(&lt;msg&gt; &lt;sig&gt;)) (sha256 (car '(&lt;msg&gt; &lt;sig&gt;))))
</code></pre></div></div>

<p>Next the car’s and cdr’s evaluate, extracting the specific arguments needed:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(sig_valid &lt;pubkey&gt; &lt;sig&gt; (sha256 &lt;msg&gt;))
</code></pre></div></div>

<p>The message is hashed:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(sig_valid &lt;pubkey&gt; &lt;sig&gt; &lt;SHA256(msg)&gt;)
</code></pre></div></div>

<p>And finally <code class="highlighter-rouge">sig_valid</code> and its arguments evaluates to true:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>True
</code></pre></div></div>

<h3 id="multisig">Multisig</h3>

<p>With just a single key our identity expression has a single point of failure.
Let’s change it to require 2-of-2 signatures, allowing those two keys to be
placed on separate, isolated, machines for greater security. Our signature
expression will now be <code class="highlighter-rouge">(&lt;sig1&gt; &lt;sig2&gt;)</code>, and our validation expression:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(and (sig_valid &lt;pubkey1&gt; (car (cdr argm)) (sha256 (car argm)))
     (sig_valid &lt;pubkey2&gt; (cdr (cdr argm)) (sha256 (car argm))))
</code></pre></div></div>

<p>For the expression to be true, both signatures must be valid. While at first
glace it would appear that a number of calculations are duplicated, this
doesn’t need to be true: expression evaluation is strictly deterministic, so
results can be cached and reused; expressions are directed acyclic graphs, not
trees.</p>

<h3 id="temporary-delegation">Temporary Delegation</h3>

<p>What if we want to temporarily delegate message signing authority? We can do
this by signing a sub-expression. First we’ll introduce a new primitive that
evaluates to the digest of the specified expression:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(digest &lt;expr&gt;) =&gt; bytes
</code></pre></div></div>

<p>Second we’ll introduce the <code class="highlighter-rouge">eval</code> operator, so we can evaluate expressions:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(eval &lt;expr&gt;) =&gt; &lt;evaluated expr&gt;
</code></pre></div></div>

<p>We need to make the time available to the identity expression, however if we
make the current time available, we’d no longer have a deterministic signature.
So instead we change our validity protocol to expect signatures to contain a
<em>claimed</em> time, which is verified to be less than the actual time separately:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(persist_id &lt;msg&gt; (claimed_time &lt;sig_expr&gt;)) =&gt; boolean
</code></pre></div></div>

<p>Finally our signature now includes a sub-expression and a binding signature
signing that sub-expression: <code class="highlighter-rouge">((&lt;binding_sig&gt; &lt;sub_expr&gt;) &lt;sub_sig&gt;)</code>. Our
identity expression now validates that binding signature and evaluates the
sub-expression against the sub-signature:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(and (sig_valid &lt;master_pubkey&gt; (car (car (cdr argm))) (SHA256 (cdr (car (cdr argm)))))
     (eval ((cdr (car (cdr argm)))) (cons argm (cdr (cdr argm)))))
</code></pre></div></div>

<p>That expression is rather hard to read with all the car’s and cdr’s used on
argm directly; here’s it with symbolic names instead:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(and (sig_valid &lt;master_pubkey&gt; &lt;binding_sig&gt; (SHA256 &lt;delegated_expr&gt;)
     (eval &lt;delegated_expr&gt; (cons argm &lt;sig_expr&gt;))
</code></pre></div></div>

<p>Finally, the delegated expression:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(and (sig_valid &lt;delegated_pubkey&gt; (SHA256 (cons claimed_time msg)))
     (&lt; claimed_time delegation_expiry_time))
</code></pre></div></div>

<h2 id="state-and-non-mathematical-proof">State and non-mathematical proof</h2>

<p>Our predicate evaluation examples have been almost entirely stateless, with the
one exception of the (indirect) use of the current time via the claimed time.
While this is very mathematically pure, it’s not sufficient for many real-world
usecases like timestamping, revocation, key rotation, etc. Let’s look at why.</p>

<p>; so what’s intersting here, is that we have a repudiatable/non-repudiatable
dichotomy here: anything that relies on timestamps can be done in a
non-repudiatable model, while anything without timestamps is forced into a
repudiatable model where validity can change after the fact</p>

<h2 id="timestamping--delegation-revisited">Timestamping — Delegation Revisited</h2>

<p>Our previous delegation example has an serious drawback: signatures made by the
delegated authority are invalid after the expiry time is reached. We would like
those signatures to remain valid, while simultaneously ensuring that after the
temporary delegation expires new signatures can’t be created. We can solve this
problem with timestamping.</p>

<p>Suppose Trudy runs a timestamping service, Trudy’s Trusty Timestamps. The
predicate expression for that service, <ttt-predicate>, returns true when
provided with a valid msexpr of the form (<time> <digest> <sig>) where <sig>
is the signature returned for the service when <digest> is timestamped.</digest></sig></sig></digest></time></ttt-predicate></p>

<p>This let’s us remove the current time from the validity protocol:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(persist_id (&lt;msg&gt; &lt;sig_msexpr&gt;)) =&gt; boolean
</code></pre></div></div>

<p>Instead we’re going to rely just on the timestamp, giving us a signature of the
form:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(&lt;binding_sig&gt; &lt;delegated_msexpr&gt; &lt;timestamp_time&gt; &lt;timestamp_sig&gt; &lt;sub_sig&gt;)
</code></pre></div></div>

<p>Now our delegated expression can verify that the timestamp was valid, proving
that the signature was created prior to when the delegation expired:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(and (sig_valid &lt;delegated_pubkey&gt; (SHA256 &lt;msg&gt;))
     (&lt; timestamp_time delegation_expiry_time)
     (&lt;ttt-predicate&gt; &lt;timestamp_time&gt; (digest sub_sig) timestamp_sig))
</code></pre></div></div>

<h3 id="timestamp-latency">Timestamp Latency</h3>

<p>A problem with making temporary delegation rely on timestamps is the necessity
of getting a timestamp for every bit of data signed. We have three basic
options for our timestamps:</p>

<ol>
  <li>
    <p>Individually signed — A trusted third party signs each timestamped digest
individually. While the timestamps are small, this has poor scalability and
poor security due to large numbers of trusted timestamping servers required,
each containing critical key material.</p>
  </li>
  <li>
    <p>Signed merkle tree — Multiple digests are collected in a merkle tree, with
the tip of that tree timestamped by a trusted third party. Guardtime implements
this scheme in a multi-level system with about 1 second latency per timestamp.
Highly efficient, although at the cost of log2(n) sized timestamps.</p>
  </li>
  <li>
    <p>Decentralized blockchain — Similar to the signed merkle tree, but with a
decentralized blockchain as the root of trust. Has the advantage of no trusted
third party, at the cost of much higher latencies: minutes to as much as one or
even two hours.</p>
  </li>
</ol>

<h3 id="anti-replaylazy-commitments--key-rotation">Anti-replay/Lazy-Commitments — Key Rotation</h3>

<p>If we want to rotate keys, making the previous key permantly unusable, we face
a similar problem to the one we faced in time limited delegation: with math
alone we can’t prevent the old key from creating new signatures. With
timestamping however we can timestamp our delegation signature and redelegate
at regular intervals, prior to an expiry time.</p>

<p>What we want is a way of ensuring that some digital action can only happen
once, an anti-replay device. A well-known example of this in action is Bitcoin:
transaction outputs can be spent exactly once. Another way of looking at this
is to think in terms of a commitment: where a commitment binds you to some
future thing, like revealing a message with a particular digest, a
lazy-commitment binds you to something you haven’t chosen yet.</p>

<p>We can implement lazy-commitments in a variety of ways, such as a trusted
oracle that promises to only sign once, or by taking advantage of the fact that
a Bitcoin transaction output can only be spent once. Either way we can model
the finalized commitment as a special form of signature:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lazy_commit_valid &lt;sig&gt; &lt;digest&gt;) =&gt; bool
</code></pre></div></div>

<p>We can use the lazy-commitment in a very similar fashion to our delegation
example above:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(and (and (sig_valid &lt;master_pubkey&gt; &lt;binding_sig&gt; (SHA256 &lt;delegated_expr&gt;))
          (lazy_commit_valid &lt;lazy_sig&gt; (digest &lt;delegated_expr&gt;)))
     (eval &lt;delegated_expr&gt; (cons argm &lt;sig_expr&gt;)))
</code></pre></div></div>

<p>If the delegated expression itself has a lazy commitment the process can be
repeated indefinitely in a chain.</p>

<h3 id="revocation">Revocation</h3>

<p>With revocation we want to be able to make a key unusable, permanently
preventing valid looking signatures from being created in the future. If we
have key rotation we can of course do this by simply rotating to an invalid key
(finalizing a lazy-commitment over an expression that always evaluates to
false).</p>

<p>However an attacker can do this too, before we get a chance to revoke; what if
we want revocation even under adversarial circumstances? OpenPGP supports this
with special signed revocation packets, that are distributed on a best-effort
basis; both attacker and defender can create a revocation message. We can model
this as a function that returns true if a piece of data with a particular
digest is known to exist; here’s this in use:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(and &lt;identiy_expr&gt;
     (not (data_published &lt;digest&gt;)))
</code></pre></div></div>

<p>A practical implementation could be a service that acts as a publication
platform for revocation messages, with each message actually being a signature
that makes an expression return true; public blockchains like Bitcoin can do
this. Regardless of what publication platform is used, our goal is to ensure
that a revocation message - once published - will reliably get to all potential
verifiers.</p>

        
      </section>

      <footer class="page__meta">
        
        
  <p><a href="https://github.com/WebOfTrustInfo/rwot2-id2020/blob/master/topics-and-advance-readings/DexPredicatesForSmarterSigs.md" target="_blank" rel="noopener noreferrer">Source</a></p>



  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-users" aria-hidden="true"></i> Authors:</strong>
    
    
        Peter Todd
    
</p>






        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=didecentral&amp;text=Dex%3A+Deterministic+Predicate+Expressions+for+Smarter+Signatures%20http%3A%2F%2Flocalhost%3A4000%2Frwot-dir%2F_pages%2Frwot2-id2020%2Ftopics-and-advance-readings%2FDexPredicatesForSmarterSigs%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Frwot-dir%2F_pages%2Frwot2-id2020%2Ftopics-and-advance-readings%2FDexPredicatesForSmarterSigs%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Flocalhost%3A4000%2Frwot-dir%2F_pages%2Frwot2-id2020%2Ftopics-and-advance-readings%2FDexPredicatesForSmarterSigs%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
  <a href="https://www.reddit.com/submit?url=http%3A%2F%2Flocalhost%3A4000%2Frwot-dir%2F_pages%2Frwot2-id2020%2Ftopics-and-advance-readings%2FDexPredicatesForSmarterSigs%2F&amp;title=Dex%3A+Deterministic+Predicate+Expressions+for+Smarter+Signatures" class="btn btn--reddit" title="Share on Reddit" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a>
</section>


      
    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<input type="search" id="search" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term...">
    <div id="results" class="results"></div>
</div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="mailto:identitydecentralized@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://decentralized-id.com" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://twitter.com/didecentral" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/didecentral" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://discord.gg/eYm2XvZ" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-discord" aria-hidden="true"></i> Discord</a></li>
        
      
    

    <li><a href="/rwot-dir/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2019 DIDecentral. Powered by <a href="https://jekyllrb.com" rel="noopener noreferrer" target="_blank">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="noopener noreferrer" target="_blank">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/rwot-dir/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>




<script src="/rwot-dir/assets/js/lunr/lunr.min.js"></script>
<script src="/rwot-dir/assets/js/lunr/lunr-store.js"></script>
<script src="/rwot-dir/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
