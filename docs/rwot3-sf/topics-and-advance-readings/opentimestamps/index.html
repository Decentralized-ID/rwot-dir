<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>OpenTimestamps: Scalable, Trustless, Distributed Timestamping with Bitcoin - Rebooting the Web of Trust</title>
<meta name="description" content="RWOT Index - Drafts, Documents, Photos, Topics, Advance Readings, and Final Whitepapers">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Rebooting the Web of Trust">
<meta property="og:title" content="OpenTimestamps: Scalable, Trustless, Distributed Timestamping with Bitcoin">
<meta property="og:url" content="http://localhost:4000/rwot-dir/rwot3-sf/topics-and-advance-readings/opentimestamps/">




  <meta property="og:image" content="http://localhost:4000/rwot-dir/assets/images/rebooting-the-web-of-trust-header-pages.jpeg">



  <meta name="twitter:site" content="@didecentral">
  <meta name="twitter:title" content="OpenTimestamps: Scalable, Trustless, Distributed Timestamping with Bitcoin">
  <meta name="twitter:description" content="RWOT Index - Drafts, Documents, Photos, Topics, Advance Readings, and Final Whitepapers">
  <meta name="twitter:url" content="http://localhost:4000/rwot-dir/rwot3-sf/topics-and-advance-readings/opentimestamps/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/rwot-dir/assets/images/rebooting-the-web-of-trust-header-pages.jpeg">
  

  







  

  


<link rel="canonical" href="http://localhost:4000/rwot-dir/rwot3-sf/topics-and-advance-readings/opentimestamps/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "DIDecentral",
      "url": "http://localhost:4000/rwot-dir",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/rwot-dir/feed.xml" type="application/atom+xml" rel="alternate" title="Rebooting the Web of Trust Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/rwot-dir/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/rwot-dir/"><img src="/rwot-dir/assets/images/wot-logo.png" alt=""></a>
        
        <a class="site-title" href="/rwot-dir/">Drafts, Documents, Literature</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://decentralized-id.com/" target="_blank" rel="noopener noreferrer">DIDecentral</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero" style=" ">
  
    <img src="/rwot-dir/assets/images/rebooting-the-web-of-trust-header-pages.jpeg" alt="OpenTimestamps: Scalable, Trustless, Distributed Timestamping with Bitcoin" class="page__hero-image">
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
      
      
      
      
    
    
      

<nav class="nav__list">
  <h3 class="nav__title" style="padding-left: 0;">Rebooting the Web of Trust</h3>
  <input id="ac-toc" name="accordion-toc" type="checkbox">
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          
          

          <a href="/rwot-dir/rwot1-sf/"><span class="nav__sub-title">RWoT1-SF</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/draft-documents/" class="">Draft Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/event-documents/" class="">Event Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/final-documents/" class="">Final Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/supporting-files/" class="">Supporting Files</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot1-sf/topics-and-advance-readings/" class="">Topics and Advance Readings</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/rwot-dir/rwot2-id2020/"><span class="nav__sub-title">RWoT2-ID2020</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/draft-documents/" class="">Draft Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/event-documents/" class="">Event Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/final-documents/" class="">Final Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/supporting-files/" class="">Supporting Files</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot2-id2020/topics-and-advance-readings/" class="">Topics and Advance Readings</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          
          

          <a href="/rwot-dir/rwot3-sf/"><span class="nav__sub-title">RWoT3-SF</span></a>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/draft-documents/" class="">Draft Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/event-documents/" class="">Event Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/final-documents/" class="">Final Documents</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/supporting-files/" class="">Supporting Files</a></li>
          
            
            

            
            

            <li><a href="/rwot-dir/rwot3-sf/topics-and-advance-readings/" class="">Topics and Advance Readings</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="OpenTimestamps: Scalable, Trustless, Distributed Timestamping with Bitcoin">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">OpenTimestamps: Scalable, Trustless, Distributed Timestamping with Bitcoin
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  18 minute read
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p>By Peter Todd</p>

<p><em>This is a reprint of a post from my blog; the <a href="https://petertodd.org/2016/opentimestamps-announcement" target="_blank" rel="noopener noreferrer">original</a> has better formatting. This reprint exists here only for the purpose of decentralization/archiving.</em></p>

<p>I’ve spent the past few weeks working on<sup id="fnref:rewrite"><a href="#fn:rewrite" class="footnote">1</a></sup> an old<sup id="fnref:first-commit"><a href="#fn:first-commit" class="footnote">2</a></sup> project of mine,
OpenTimestamps, and it’s ready for a <a href="https://github.com/opentimestamps/opentimestamps-client/tree/opentimestamps-client-v0.2.0" target="_blank" rel="noopener noreferrer">public alpha release</a>. It’s timestamping
infrastructure with three big advantages over the existing alternatives:</p>

<ol>
  <li>
    <p><strong>Trust</strong> — OpenTimestamps uses the decentralized, publicly
auditable, Bitcoin blockchain, removing the need for trusted authorities;
OpenTimestamps’s architecture is designed to support multiple, cross-checked,
notarization methods in the future.</p>
  </li>
  <li>
    <p><strong>Cost</strong> — OpenTimestamps scales indefinitely, allowing timestamps to be
created for free by combining an unlimited number of timestamps into one
Bitcoin transaction.</p>
  </li>
  <li>
    <p><strong>Convenience</strong> — OpenTimestamps can create a third-party-verifiable timestamp
in about a second; you don’t need to wait for a Bitcoin confirmation.</p>
  </li>
</ol>

<p>In this post we’ll talk about what timestamps can do, what they can’t do, how
to use OpenTimestamps to timestamp files, and how OpenTimestamps works under
the hood. OpenTimestamps can also timestamp Git commits; we’ll discuss Git
integration in a follow-up post.</p>

<p><strong>Acknowledgements</strong>: <a href="https://www.verisart.com/" target="_blank" rel="noopener noreferrer">Verisart</a> funded development work
I did last year on an earlier version of OpenTimestamps - now used in their
<a href="https://techcrunch.com/2015/07/07/verisart-plans-to-use-the-blockchain-to-verify-the-authencity-of-artworks/" target="_blank" rel="noopener noreferrer">digital art provenance</a>
solution. Additionally <a href="https://www.btcc.com/" target="_blank" rel="noopener noreferrer">BTCC</a> funds my Bitcoin
development efforts, and while OpenTimestamps isn’t specifically part of that,
that funding did give me the ability to work on it. Finally, <a href="https://github.com/RCasatta" target="_blank" rel="noopener noreferrer">Riccardo Casatta</a>
contributed to development and testing, and <a href="http://blog.eternitywall.it/2016/06/24/announcing-opentimestamps-support/" target="_blank" rel="noopener noreferrer">implemented an earlier version</a>
of OpenTimestamps on his <a href="https://eternitywall.it/" target="_blank" rel="noopener noreferrer">Eternity Wall</a> service.</p>

<h2 id="what-can-and-cant-timestamps-prove">What Can and Can’t Timestamps Prove?</h2>

<p>A timestamp proves that a message existed prior to some point in time;
timestamps are occasionally referred to as “proofs-of-existence”. Being able to
prove that data existed prior to a point in time is surprisingly useful. Let’s
look at some use-cases to understand why:</p>

<h3 id="record-integrity">Record Integrity</h3>

<blockquote>
  <p>Our colocation centre informed us that someone broke into the cage the
backend servers are located in last night; the last off-site backups were a
week ago. The auditors want to know which records the intruders
might have changed after they broke in. What do I tell them?</p>
</blockquote>

<p>If we know when the intrusion happened, and have trustworthy timestamps for all
records on the servers, we can use those timestamps to prove records existed
prior to the intrusion. This lets post-intrusion auditing and recovery efforts
focus on a much smaller set of data.</p>

<p>However, timestamps can’t help you if you don’t know when the intrusion
happened, nor can they help for records created after: the intruder could have
just as easily made the timestmap on data they’ve modified. But still, this is
an excellent use of timestamping, one that usually helps, and will never make
the problem any worse.</p>

<h3 id="software-signing-and-pgp">Software Signing and PGP</h3>

<blockquote>
  <p>I need to install this two-year-old software package to recover old records,
but the developer revoked their PGP key six months ago - apparently their
laptop got stolen. How do I know I’m getting the real thing?</p>
</blockquote>

<p>PGP revocations have dates on them, so if the revocation is dated after the
signature on the software - and there’s a valid timestamp for that signature -
you’re good to go!<sup id="fnref:pgp-revocation"><a href="#fn:pgp-revocation" class="footnote">3</a></sup> Again, this is an excellent timestamping
use case.</p>

<h3 id="evidence-authenticity">Evidence Authenticity</h3>

<blockquote>
  <p>I found a two-year-old snapshot of the defendant’s website on a public archiving
service, but is it authentic?</p>
</blockquote>

<p>A timestamp on a website snapshot doesn’t necessarily mean the snapshot is
authentic, but it does greatly limit the scope of who might have tampered with
the data. How likely is it that someone hacked into the archiving service, well
before they knew there would be a lawsuit?</p>

<blockquote>
  <p>I run a website archiving service, but I don’t have the resources to hire
auditors or security consultants. How can I prove our archives haven’t
been modified after the fact?</p>
</blockquote>

<p>Simple answer: timestamps only make your problem better, not worse!</p>

<blockquote>
  <p>My colleague said X in an IRC chat last year, but ever since the project
failed they’re now claiming they said Y. How do I prove they’re lying?</p>
</blockquote>

<p>A timestamp only proves <em>a</em> message existed, not <em>the</em> message. Last year,
would you have known the significance of X and Y? If so, you could have
timestamped two conflicting IRC logs.</p>

<blockquote>
  <p>This anonymous crypto-currency ByteCoin looks pretty cool, the technology is legit, and
there’s a two-year old community around it. <a href="https://bitcointalk.org/index.php?topic=740112.0" target="_blank" rel="noopener noreferrer">It can’t be a recently-created
pre-mined scam with a fake community, right?</a></p>
</blockquote>

<p>Timestamps can’t help you here: ByteCoin’s creators wouldn’t have timestamped
anything. Additionally, keep in mind that even if they did, creating a
crypto-currency from scratch could have very well taken two years - enough time
to create perfectly valid timestamps for things that the public never saw.</p>

<h3 id="ownership">Ownership</h3>

<blockquote>
  <p>I want to secure land titles on the blockchain with timestamps!</p>
</blockquote>

<p>Timestamps do <em>not</em> by themselves solve the doublespend problem; <a href="http://www.metzdowd.com/pipermail/cryptography/2016-August/029947.html" target="_blank" rel="noopener noreferrer">Bitcoin is a
lot more than just a way to timestamp data</a>.</p>

<p>Having said that, timestamps can provide evidence that ownership <em>records</em> are
accurate; my client Verisart aims to do exactly that in for art provenance
records. While a timestamp on an art provenance record such as a gallery sales
receipt doesn’t by itself prove that record is valid, it can limit the scope of
potential fraud, allowing provenance investigators to focus their efforts by
eliminating many of the possible fraud scenarios they may be dealing with.</p>

<h2 id="creating-and-validating-timestamps">Creating and Validating Timestamps</h2>

<p>First, get the <a href="https://github.com/opentimestamps/opentimestamps-client" target="_blank" rel="noopener noreferrer">OpenTimestamps Client</a>,
version 0.2.0:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/opentimestamps/opentimestamps-client.git
cd opentimestamps-client
git checkout opentimestamps-client-v0.2.0
</code></pre></div></div>

<p>and install the dependencies:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 install -r requirements.txt
</code></pre></div></div>

<p>There’s no system-wide installation process, so we’ll run it directly out of
the repo. Creating a timestamp is fast and simple:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots stamp README.md
Submitting to remote calendar https://a.pool.opentimestamps.org
Submitting to remote calendar https://b.pool.opentimestamps.org
</code></pre></div></div>

<p>You’ll see that <code class="highlighter-rouge">README.md.ots</code> has been created. We can’t verify it
immediately however:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots verify README.md.ots
Assuming target filename is 'README.md'
Calendar https://alice.btc.calendar.opentimestamps.org: No timestamp found
Calendar https://bob.btc.calendar.opentimestamps.org: No timestamp found
</code></pre></div></div>

<p>It takes a few hours for the timestamp to get confirmed by the Bitcoin
blockchain; we’re not doing one transaction per timestamp.</p>

<p>However, the client does come with a number of example timestamps which you
can try verifying immediately. You’ll need a local <a href="https://bitcoincore.org/" target="_blank" rel="noopener noreferrer">Bitcoin Core</a>
node (a pruned node is fine) with the <code class="highlighter-rouge">rpcuser</code> and <code class="highlighter-rouge">rpcpassword</code> options set
in <code class="highlighter-rouge">~/.bitcoin/bitcoin.conf</code> to allow the OpenTimestamps client to connect to
your node via the RPC interface. Once that’s setup, let’s try verifying
<code class="highlighter-rouge">examples/hello-world.txt</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat examples/hello-world.txt
Hello World!
$ ./ots verify examples/hello-world.txt.ots
Assuming target filename is 'examples/hello-world.txt'
Success! Bitcoin attests data existed as of Thu May 28 15:41:18 2015 UTC
</code></pre></div></div>

<p>Simple!</p>

<h2 id="how-opentimestamps-works">How OpenTimestamps Works</h2>

<p><em>Those already familiar with Bitcoin and hash functions may want to skip to <a href="#commitment-operations">Commitment Operations</a>.</em></p>

<p>But how did that actually work? Let’s start by adding the verbose flag and
trying verify again:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots -v verify examples/hello-world.txt.ots
Assuming target filename is 'examples/hello-world.txt'
Hashing file, algorithm sha256
Got digest 03ba204e50d126e4674c005e04d82e84c21366780af1f43bd54a37816b6ab340
Attestation block hash: 000000000000000003e892881a8cdcdc117c06d444057c98b6f04a9ee75a2319
Attested time: 1432827678
Success! Bitcoin attests data existed as of Thu May 28 15:41:18 2015 UTC
</code></pre></div></div>

<h3 id="notaries-and-time-attestations">Notaries and Time Attestations</h3>

<p>Every Bitcoin block header has a field in it called <code class="highlighter-rouge">nTime</code>. For a Bitcoin
block to be accepted by the network the Bitcoin protocol requires that field to
be set to approximately the time the block was created. Exactly how accurate
that field must be for a block to be valid is a complex topic, but for our
purposes it’s fair to say it’ll very likely be accurate to within two or three
hours - even if a sizable minority of Bitcoin miners are trying to create
invalid timestamps - and almost certainly within a day.</p>

<p>Thus we can say Bitcoin is a <em>notary</em>, and we can use Bitcoin block headers as
<em>time attestations</em>: proof that a notary that we trust <em>attested</em> to the fact
that some data existed at some point in time. That means that if Bitcoin is
working correctly these 80 bytes - the block header for block 358,391 - existed
on May 28th, 2015:</p>

<pre>
02000000b96394585a281b7e5f438fd1c9ed492645a1fd61cb3802040000000000000000007ee445
d23ad061af4a36b809501fab1ac4f2d7e7a739817dd0cbb7ec661b8a1e376755f58616186272def6
</pre>

<h3 id="merkle-trees">Merkle Trees</h3>

<p>Of course, our message “Hello World!” isn’t included in those 80 bytes! But
neither are any transactions! So how does Bitcoin link the transactions in a
block to the block header? With another field, called the <code class="highlighter-rouge">merkleroot</code>,
shown here in bold:</p>

<pre>
02000000b96394585a281b7e5f438fd1c9ed492645a1fd61cb3802040000000000000000<b>007ee445</b>
<b>d23ad061af4a36b809501fab1ac4f2d7e7a739817dd0cbb7ec661b8a</b>1e376755f58616186272def6
</pre>

<p>The value of the <code class="highlighter-rouge">merkleroot</code> is calculated by taking all the transactions in a
block and creating a merkle tree, shown here in this diagram from the book
<a href="http://chimera.labs.oreilly.com/books/1234000001802/ch07.html#merkle_trees" target="_blank" rel="noopener noreferrer">Mastering Bitcoin</a>:</p>

<p><img src="opentimestamps-merkle-tree.png" alt="Merkle Tree"></p>

<p>Each arrow represents a <a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function" target="_blank" rel="noopener noreferrer">cryptographic hash function</a>, which
takes an variable-length message, and transforms it to a fixed-length digest.
Importantly, a secure hash function has the property that it’s not possible to
find two messages that hash to the same digest. Pairs of messages that
“collide” to produce the same digest <em>do</em> exist, but the numbers involved are
so enormous that actually finding collisions isn’t believed to be physically
possible:</p>

<blockquote>
  <p>These numbers have nothing to do with the technology of the devices; they are
the maximums that thermodynamics will allow. <strong>And they strongly imply that
brute-force attacks against 256-bit keys will be infeasible until computers are
built from something other than matter and occupy something other than space.</strong>
-Bruce Schneier, Applied Cryptography</p>
</blockquote>

<p>This means that if we change any of the transactions at the bottom of the tree,
every digest above the modified transaction changes, ultimately changing the
<code class="highlighter-rouge">merkleroot</code> at the tip of the tree. For example, if we changed the last byte
of the last transaction in block 358,391 from <code class="highlighter-rouge">0x00</code> to <code class="highlighter-rouge">0x01</code> the merkle root
changes completely:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Original: 007ee445d23ad061af4a36b809501fab1ac4f2d7e7a739817dd0cbb7ec661b8a
Modified: 87808e5a6a196e401bde8ebaf5b453825cdc3b66b87526bb355d519ae52ba42b
</code></pre></div></div>

<p>Finally, it turns out that if you take our message <code class="highlighter-rouge">Hello World!\n</code> and hash
it, we get:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RIPEMD160(SHA256('Hello World!\n')) =&gt; 1df8859e60bc679503d16dcb870e6ce91a57e9df
</code></pre></div></div>

<p>That digest happens to be in the Bitcoin transaction
7e9f0f7d9daa2d9e51b2e22f4abe814c3f90539afa778a9bef88dc64627cb2ec<sup id="fnref:hello-world-address"><a href="#fn:hello-world-address" class="footnote">4</a></sup>,
and thus if were were to change that message, the digest would change, changing
the transaction, changing the merkle tree, and finally, changing the block
header. Since you can’t change the message without changing the block header,
we’ve proven that the message must have existed prior to when the block header
was created - this is a timestamp proof!</p>

<h3 id="commitment-operations">Commitment Operations</h3>

<p>Another way of describing that proof is to say that the block header <em>commits</em>
to the merkle tree, and the merkle tree commits to the transactions; the
transactions are <em>committed</em> by the block header, because changing the
transactions changes the header. We can also say that a cryptographic hash
function is a <em>commitment operation</em>, because the input to the operation can’t
be changed without changing the result.</p>

<p>An even simpler example of a commitment operation is the <code class="highlighter-rouge">append</code> operation:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"Foo" -&gt; append("Bar") -&gt; "FooBar"
</code></pre></div></div>

<p>It’s easy to see why this is a commitment operation: if I change the input the
it’s obvious that the result must change - it contains the input itself!</p>

<p>A timestamp proof in OpenTimestamps is just a list of commitment
operations that are applied to the message in sequence. To verify the proof,
all that needs to be done is to replay the operations, and check that the final
result is a message that you already know existed at a certain time. Since
every commitment operation is guaranteed to have a different result for a
different input, there’s no way to change the message we’re timestamping
without changing the result and invalidating the timestamp.</p>

<p>We can see the actual operations in our timestamp with:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots info examples/hello-world.txt.ots
File sha256 hash: 03ba204e50d126e4674c005e04d82e84c21366780af1f43bd54a37816b6ab340
Timestamp:
ripemd160
prepend 0100000001e482f9d32ecc3ba657b69d898010857b54457a90497982ff56f97c4ec58e6f98010000006b483045022100b253add1d1cf90844338a475a04ff13fc9e7bd242b07762dea07f5608b2de367022000b268ca9c3342b3769cdd062891317cdcef87aac310b6855e9d93898ebbe8ec0121020d8e4d107d2b339b0050efdd4b4a09245aa056048f125396374ea6a2ab0709c6ffffffff026533e605000000001976a9140bf057d40fbba6744862515f5b55a2310de5772f88aca0860100000000001976a914
append 88ac00000000
sha256
sha256
prepend a987f716c533913c314c78e35d35884cac943fa42cac49d2b2c69f4003f85f88
sha256
sha256
prepend dec55b3487e1e3f722a49b55a7783215862785f4a3acb392846019f71dc64a9d
sha256
sha256
prepend b2ca18f485e080478e025dab3d464b416c0e1ecb6629c9aefce8c8214d042432
sha256
sha256
append 11b0e90661196ff4b0813c3eda141bab5e91604837bdf7a0c9df37db0e3a1198
sha256
sha256
append c34bc1a4a1093ffd148c016b1e664742914e939efabe4d3d356515914b26d9e2
sha256
sha256
append c3e6e7c38c69f6af24c2be34ebac48257ede61ec0a21b9535e4443277be30646
sha256
sha256
prepend 0798bf8606e00024e5d5d54bf0c960f629dfb9dad69157455b6f2652c0e8de81
sha256
sha256
append 3f9ada6d60baa244006bb0aad51448ad2fafb9d4b6487a0999cff26b91f0f536
sha256
sha256
prepend c703019e959a8dd3faef7489bb328ba485574758e7091f01464eb65872c975c8
sha256
sha256
append cbfefff513ff84b915e3fed6f9d799676630f8364ea2a6c7557fad94a5b5d788
sha256
sha256
prepend 0be23709859913babd4460bbddf8ed213e7c8773a4b1face30f8acfdf093b705
sha256
sha256
verify BitcoinBlockHeaderAttestation(358391)
</code></pre></div></div>

<p>The big advantage of representing a timestamp this way is it doesn’t matter
<em>how</em> you create the timestamp: so long as you can extract a valid list of
commitment operations that the OpenTimestamps protocol supports, you can create
a timestamp that any OpenTimestamps-compatible verifier can verify.</p>

<h4 id="timestamp-operation-tree">Timestamp Operation Tree</h4>

<p>Additionally, rather than being limited to a linear list of operations,
timestamps are actually <em>trees</em> of operations, with the root of the tree being
the message, the edges the commitment operations, and the leaves the
attestations. We’ll see how this functionality is currently used when we
discuss calendars; in the future this will allow a single message to be
timestamped with multiple notaries. For instance multiple proof-of-work
blockchains such as Bitcoin and Litecoin could be used simultaneously, as well as
notaries offering different trust models and accuracy guarantees, such as traditional
<a href="http://www.rfc-base.org/txt/rfc-3161.txt" target="_blank" rel="noopener noreferrer">RFC-3161</a> timestamps and Certificate
Transparency servers.</p>

<h3 id="scalability-through-aggregation">Scalability Through Aggregation</h3>

<p>An important way we use the flexibility commitment operations provides us is for
scalability. For example, suppose you want to timestamp 10,000 different files:
with most existing Bitcoin timestamping solutions, that would require 10,000
Bitcoin transactions - inefficient and expensive. But with OpenTimestamps, you
can instead create a merkle tree of those 10,000 files and timestamp the tip of
that tree in one transaction. Each per-file timestamp is simply the list of
commitment operations that comprise the path up the first merkle tree, then up
the Bitcoin block’s merkle tree, to finally get to the block header. The
verifier doesn’t care: to it it’s just a series of operations like any other
timestamp.</p>

<p>Secondly, we further improve this with a system of aggregation servers:
publically available “meeting points” where anyone can submit a digest to be
timestamped. As of writing, there are two public aggregation servers,
<code class="highlighter-rouge">a.pool.opentimestamps.org</code>, and <code class="highlighter-rouge">b.pool.opentimestamps.org</code></p>

<p>As digests are submitted for aggregation, they’re added to a list of pending
digests. Periodically that list is combined into a single merkle tree, and then
the tip of that tree is timestamped with Bitcoin. The server then returns the
individual timestamp proofs for each submitted digest (conceptually speaking;
see the next section for how it actually works!). This process can be done
multiple layers deep, with merkle trees timestamping tips of merkle trees
timestamping tips of merkle trees. An unlimited number of messages can be
timestamped every second, and the system can scale from one user to an
unlimited number of users without making any changes at all to the way
timestamps are verified.</p>

<p>While the aggregation process works most efficiently with centralization, it’s
still essentially trustless: the worst an aggregation server can do is go
offline, an inconvenience. The aggregation system <em>can’t</em> produce a fake
timestamp, because it’s Bitcoin, not the aggregation system, that proves the
validity of a timestamp.</p>

<h3 id="public-calendars">Public Calendars</h3>

<p>While aggregation servers are efficient, they aren’t convenient: you still have
to wait for the underlying Bitcoin transaction to confirm. This takes at least
10 minutes on average, and can take significantly longer if you’re unlucky. For
some applications that’s OK, and the OpenTimestamps client supports a <code class="highlighter-rouge">--wait</code>
flag that’ll simply wait until the underlying Bitcoin transaction is confirmed.</p>

<p>But for many applications that’s nowhere near fast enough. For example, if
you’re sending a timestamped PGP-signed email, or signing a timestamped Git
commit, you want the timestamping process to finish within a second or two at
most - that’s not even possible with any existing decentralized consensus
system!</p>

<p>OpenTimestamps solves this problem with a compromise: public calendar servers.
A calendar is simply a collection of timestamps; a calendar server provides
remote access to a calendar. As of writing, there are two public calendar
servers<sup id="fnref:shared-hosting-details"><a href="#fn:shared-hosting-details" class="footnote">5</a></sup> in operation,
<code class="highlighter-rouge">alice.btc.calendar.opentimestamps.org</code>, and <code class="highlighter-rouge">bob.btc.calendar.opentimestamps.org</code></p>

<p>The calendar servers work in conjunction with the aggregation servers: rather
than wait until the pending digests are timestamped by Bitcoin, what the
aggregation system actually does is aggregates all submitted timestamps in a
one second interval into a merkle tree, and submits the tip of that tree -
which we call a “commitment” - to a public calendar server. The calendar server
makes two promises:</p>

<ol>
  <li>
    <p>Every commitment added to the calendar will be timestamped by the Bitcoin
blockchain in a reasonable amount of time.</p>
  </li>
  <li>
    <p>Completed commitment timestamps will be made available to the public and
kept indefinitely.</p>
  </li>
</ol>

<p>We call a timestamp made using a calendar server an incomplete timestamp.
Here’s an example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots info examples/incomplete.txt.ots
File sha256 hash: 05c4f616a8e5310d19d938cfd769864d7f4ccdc2ca8b479b10af83564b097af9
Timestamp:
append e754bf93806a7ebaa680ef7bd0114bf4
sha256
append b573e8850cfd9e63d1f043fbb6fc250e
sha256
prepend 57cfa5c4
append 6fb1ac8d4e4eb0e7
verify PendingAttestation('https://alice.btc.calendar.opentimestamps.org')
</code></pre></div></div>

<p>See the last line? When we try to verify the timestamp, that line tells the
verifier to ask the remote calendar “Alice” for the rest of the timestamp:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots verify examples/incomplete.txt.ots
Assuming target filename is 'examples/incomplete.txt'
Got 1 new attestation(s) from https://alice.btc.calendar.opentimestamps.org
Success! Bitcoin attests data existed as of Wed Sep  7 05:56:43 2016 UTC
</code></pre></div></div>

<p>Thus, with the aid of a publicly available aggregation and calendar
infrastructure, we can create the timestamp quickly and conveniently in about
one second, yet anyone can verify the timestamp later, using the decentralized,
trustless, Bitcoin blockchain.</p>

<p>Of course, this convenience does have a cost: the public calendars <em>are</em> a
central point of failure. For that reason we call a timestamp that requires the
assistance of a public calendar server an <em>incomplete</em> timestamps.
OpenTimestamps mitigates this risk in a number of ways:</p>

<h4 id="using-calendars-is-optional">Using Calendars is Optional</h4>

<p>First and foremost, you can create timestamps that don’t depend on calendars by
using the <code class="highlighter-rouge">--wait</code> option. If enabled, the client simply waits until the
timestamp is completely confirmed by the Bitcoin blockchain. The resulting
timestamp will contain all the data needed to prove the timestamp with Bitcoin,
allowing verification to be done completely locally.</p>

<h4 id="upgrading-timestamps">Upgrading Timestamps</h4>

<p>An incomplete timestamp can be upgraded later with the ‘ots upgrade’ command.
The complete Bitcoin proof will be downloaded from the calendar and saved as
part of the timestamp, with the result being as though you used the <code class="highlighter-rouge">--wait</code>
option in the first place.</p>

<h4 id="redundancy">Redundancy</h4>

<p>By default when creating timestamps two public calendars are used
simultaneously, and the timestamp is only saved if we get a response back from
both:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots info examples/two-calendars.txt.ots
File sha256 hash: efaa174f68e59705757460f4f7d204bd2b535cfd194d9d945418732129404ddb
Timestamp:
append 839037eef449dec6dac322ca97347c45
sha256
 -&gt; append 6b4023b6edd3a0eeeb09e5d718723b9e
    sha256
    prepend 57d46515
    append eadd66b1688d5574
    verify PendingAttestation('https://alice.btc.calendar.opentimestamps.org')
 -&gt; append a3ad701ef9f10535a84968b5a99d8580
    sha256
    prepend 57d46516
    append 647b90ea1b270a97
    verify PendingAttestation('https://bob.btc.calendar.opentimestamps.org')
</code></pre></div></div>

<p>Note how we’re taking advantage of the fact that timestamps are commitment
operation trees: the path splits after the <code class="highlighter-rouge">sha256</code> operation. So long as at
least one of the calendars is available the timestamp can be verified.</p>

<p>You are of course able to use your own calendars, both instead of, and
in addition too, the public calendars. For example, Example Inc. could setup their
own calendar, which in turn uses the public calendars to actually create the
Bitcoin proofs (potentially falling back on its own wallet if the public
calendars are down). Such a timestamp might look like the following:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots info &lt;some file&gt;.ots
File sha256 hash: 522cf38077181bf09ce229d2bf49d23b8d7a4e9fcf7e23d7455ad2e665bf17cd
Timestamp:
append 839037eef449dec6dac322ca97347c45
sha256
 -&gt; verify PendingAttestation('https://calendar.example.com')
    sha256
    append 1467861d8186c1df176ef2efc08d553d2dd183aadec403335d707f1e90fe3e92
    sha256
    prepend 192e8f15b77bdc5a85e346d081c995f7459dcde9f68a3523e0ae453c5a693ef9
     -&gt; append 6b4023b6edd3a0eeeb09e5d718723b9e
        sha256
        prepend 57d46515
        append eadd66b1688d5574
        verify PendingAttestation('https://alice.btc.calendar.opentimestamps.org')
     -&gt; append a3ad701ef9f10535a84968b5a99d8580
        sha256
        prepend 57d46516
        append 647b90ea1b270a97
        verify PendingAttestation('https://bob.btc.calendar.opentimestamps.org')
</code></pre></div></div>

<p>The client has a whitelist of calendars it’ll contact automatically, so users
external to Example Inc. will just ignore their pending attestation and try the
public calendars instead; whether or not Example Inc. chooses to make the
calendar publicly accessible is up to them, but regardless, they don’t have
to rely on the public calendars to verify their timestamps.</p>

<p>Software to actually do this isn’t written yet on the server side. But once it
is written it’ll be compatible with existing clients - a good example of the
advantages of the commitment operations model.</p>

<h4 id="caching-and-mirroring">Caching and Mirroring</h4>

<p>The OpenTimestamps client maintains a cache of timestamp data retrieved from
calendar servers. We can see this if we verify a timestamp twice:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots verify examples/incomplete.txt.ots
Assuming target filename is 'examples/incomplete.txt'
Got 1 attestation(s) from cache
Success! Bitcoin attests data existed as of Wed Sep  7 05:56:43 2016 UTC
</code></pre></div></div>

<p>We can also upgrade a timestamp directly from the cache, even if the calendar
isn’t available:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ./ots upgrade examples/incomplete.txt.ots
Got 1 attestation(s) from cache
Success! Timestamp is complete
</code></pre></div></div>

<p>The upgraded timestamp can be verified by anyone, using nothing more than their
local Bitcoin node.</p>

<p>More generally, timestamp proofs have the property that they’re
self-validating: regardless of where you got the proof, you can still validate
the timestamp.  In the near future I hope to take advantage of this property by
making it easy for anyone to make mirrors of the public calendars, be it just
the subset of timestamps relevant to them, or complete copies. This data is
relatively small: with 31 million seconds in a year and about 100 bytes
per second (amortised), a complete calendar mirror would consume about three
gigabytes per year.</p>

<p>This also means that decentralized calendar mirroring with technologies such as
Freenet, Tahoe-LAFS, and IPFS will be very practical; equally the write-once
and small size of the data makes DDoS resistant hosting easy to use.</p>

<h4 id="legal-risks">Legal Risks</h4>

<p>I expect the legal risks of operating calendar infrastructure to be low for a
number of reasons:</p>

<ol>
  <li>
    <p>Calendars aren’t authoritative — at worst they can deny service, not
produce false proofs.</p>
  </li>
  <li>
    <p>Taking down calendars is pointless — the data (will be) easy to mirror
widely.</p>
  </li>
  <li>
    <p>Calendars don’t store externally provided data — all incoming digests are
nonced, and only commitments to those digests are stored permanently.</p>
  </li>
</ol>

<p>Quite likely, the biggest legal risk is software patents.</p>
<div class="footnotes">
  <ol>
    <li id="fn:rewrite">
      <p>By “working on” I pretty much re-wrote the entire thing from scratch, adding a number of features that the previous architecture didn’t easily support. <a href="#fnref:rewrite" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:first-commit">
      <p>OpenTimestamps is actually my first Bitcoin project: the earliest Git commits date back to <a href="https://github.com/opentimestamps/opentimestamps-server/commit/6e2519d0bb8af2c6ec006e7849d626b20af99a77" target="_blank" rel="noopener noreferrer">June 8th 2012</a>, a year and a half before I quit my job to work on Bitcoin full-time. <a href="#fnref:first-commit" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:pgp-revocation">
      <p>An interesting nuance to this is someone who has stolen a PGP key could <em>also</em> create a revocation, and they could backdate it to <em>deny</em> access to previously created signatures; there’s a lot of interesting design questions about how to deal with this with random beacons and the like that are beyond the scope of this blog post. <a href="#fnref:pgp-revocation" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:hello-world-address">
      <p>It’s the Bitcoin address 13jUKAuPDfgVPVgsVbeKVNWBv6wAh31vkN. <a href="#fnref:hello-world-address" class="reversefootnote">↩</a></p>
    </li>
    <li id="fn:shared-hosting-details">
      <p>In reality, the two aggregation servers and two calendar servers are combined into two machines, with each one running a combination aggregator and calendar. But that’s an implementation detail that will likely change in the future as the infrastructure is scaled up. <a href="#fnref:shared-hosting-details" class="reversefootnote">↩</a></p>
    </li>
  </ol>
</div>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=didecentral&amp;text=OpenTimestamps%3A+Scalable%2C+Trustless%2C+Distributed+Timestamping+with+Bitcoin%20http%3A%2F%2Flocalhost%3A4000%2Frwot-dir%2Frwot3-sf%2Ftopics-and-advance-readings%2Fopentimestamps%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Frwot-dir%2Frwot3-sf%2Ftopics-and-advance-readings%2Fopentimestamps%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Flocalhost%3A4000%2Frwot-dir%2Frwot3-sf%2Ftopics-and-advance-readings%2Fopentimestamps%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn" target="_blank" rel="noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap">
<input type="search" id="search" aria-placeholder="Enter your search term..." class="search-input" tabindex="-1" placeholder="Enter your search term...">
    <div id="results" class="results"></div>
</div>

      </div>
    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="mailto:identitydecentralized@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://decentralized-id.com" rel="noopener noreferrer" target="_blank"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
        
      
        
          <li><a href="https://twitter.com/didecentral" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://github.com/didecentral" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://discord.gg/eYm2XvZ" rel="noopener noreferrer" target="_blank"><i class="fab fa-fw fa-discord" aria-hidden="true"></i> Discord</a></li>
        
      
    

    <li><a href="/rwot-dir/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2019 DIDecentral. Powered by <a href="https://jekyllrb.com" rel="noopener noreferrer" target="_blank">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="noopener noreferrer" target="_blank">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/rwot-dir/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>




<script src="/rwot-dir/assets/js/lunr/lunr.min.js"></script>
<script src="/rwot-dir/assets/js/lunr/lunr-store.js"></script>
<script src="/rwot-dir/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
